# kvm
PiKVM guide
## Подготовка

перед тем как приступить, нам нужно закупиться, что нужно:
- Raspberry Pi 4 (именно четверка, на пятой процессор не позволит, третья слабовата)
- карта видеозахвата(подойдет простая за 800р)
- <img width="400" height="400" alt="image" src="https://github.com/user-attachments/assets/2a410f4e-8bad-4f99-96b9-5f54ce76b9bc" />
- корпус с вентиляторами для Малинки(рекомендую, ибо устройство тУпАоХуЕеТ)
- официальный блок питания
- usb-c splitter (с поддержкой OTG и питанием, [ссылка](https://www.wildberries.ru/catalog/239103563/detail.aspx))
- <img width="300" height="400" alt="image" src="https://github.com/user-attachments/assets/a110ec6a-c7bd-42c5-a80e-cc0298af6631" />
- HDMI провод
- USB провод(не лоховской, не просто зарядный провод, отталкивайтесь от своего сплиттера, дальше поймешь почему, не задавай много вопросов)
- microSD карта более чем 32Gb (ну и переходник, чтобы можно было загрузить ОС, это может быть что угодно, тут смотри как кайф)

##### Небольшое отступление по железу

- зачастую маркетплейсы продают бандл из Raspberry Pi (далее по тексту буду называть Малинкой) и комплектующим (корпус, БП, флешка, HDMI to microHDMI и так далее), так вот я рекомендую присматриваться получше, чтобы не было лишних трат. Я брал бандл с корпусом, БП, флешкой и проводом, мне не понадобился только провод и покупку считаю успешной, но есть наборы бестолковые для нашего кейса
- сплитер нам нужен для того, чтобы запитать единственный OTG порт USB-C, который еще и предназначен для питания. Он может питаться от ноутбука, но через день я словил варнинг о том, что питания маловато и скоро придется хоронить малинку
- моя карта видеозахвата называется HDTV video capture за косарь даже дешевле и ее хватает с головой, тыж не будешь себе на 4к в браузер стримить, кмон
- microSD рекомендую брать хороший, чтоб не тупила ОСь

## Приступим

#### Готовим флешку
1. первым делом нам нужно скачать образ для нашей Малинки, идем [сюда](https://files.pikvm.org/images/v2-hdmiusb-rpi4/aarch64/v2-hdmiusb-rpi4-aarch64-latest.img.xz)
2. далее нужно скачать [офф прилу для установки ОС](https://github.com/raspberrypi/rpi-imager/releases) на флешку (если что ее уже нужно присоединить)
3. [тут гайд по установке](https://docs.pikvm.org/flashing_os/#flashing-the-image)

### Подключаемся

1. на свободный USB-A 2.0 порт присоединяем HDMI новобука через карту видеозахвата
2. в USB-C разъем Малинки пихаем сплиттер, в который нужно запихнуть питание и в другой порт пустить провод от ноутбука
3. под платой, с фронтальной стороны есть разъем для SD карты, пихаем ее туда
4. опционально: если есть вентилятор, то красный провод подключаем на 3-й пин по правому краю, а черный на 2-й пин, если расположить устройство так, что все порты внизу, оч аккуратно с этим, может замкнуть(у меня так было, чуть не похоронил)
5. обязательно нужно подключить патчкорд от модема, роутера и так далее, вай-фай потом настроим
6. идем в браузер и вписываем айпи устройства в локальной сети (как узнать айпи, спроси у нейросети), если не получается по айпи, то может помочь такой адрес: `localhost.localdomain`
7. и логин и пароль `admin` ([обязательно смени!](https://docs.pikvm.org/auth/#changing-the-kvm-password))
8. всякие приседания с настройкой делаем в терминале, но а мы переходим в KVM
  - <img width="1259" height="1100" alt="Pasted image 20250806120715 1" src="https://github.com/user-attachments/assets/627556fc-57e4-46ca-8f59-350c18a1b6ca" />
10. вуаля (VNC настроим ниже)

##### Небольшое отступление по софту

- проверь, что у тебя все работает, у меня, например, не работали мышь и клава, потому что проблема оказалась в проводе от ноутбука, потому тут уже нужно подбирать, чтобы провод был функциональным
- в настройках есть такая штука, как mouse jiggler - отличная вещь которая делает микро движение, чтобы экран не тух
  - <img width="623" height="559" alt="Pasted image 20250806120538" src="https://github.com/user-attachments/assets/035c5dfc-d166-4630-bc51-f7347a383118" />

### Настройка VNC и достпупа вне локальной сети

Малинка готова к работе... Только в локальной сети, хых
Недавно для себя открыл пиздатый сервис. Чтобы не ебаться с тем, чтобы делать публичный IP, натирование и остальной онанизм, чтобы доступ был не только локально, есть такое классное изобретение, а именно **Tailscale**
Если кратко - то эта штука создает такую приватную сеть(да, это VPN - запрещенная в России экстремисткая организация) к которой подключаются ваши локальные устройства и их можно юзать откуда угодно по выданному IP внутри этого сервиса

VNC (Virtual Network Computing) — это технология удалённого доступа к рабочему столу компьютера, позволяющая управлять другим компьютером через сеть, как будто вы находитесь перед ним.

Настроив эти штуки, мы сможем спокойно подключаться к нашей Малинке, которая управляет нашим компом

### Погнали

1. заходим в терминал Малинки
2. переходим в режим read-write командой `rw` (важно! если нет доступа у юзера, то регаемся через рут права `su root`, пароль `root`)
3. врубаем VNC `systemctl enable --now kvmd-vnc`
4. проверяем, что активно `systemctl status kvmd-vnc`
6. обновляем репо пакмана `pacman -Syy`
7. устанавливаем tailscale `pacman -S tailscale-pikvm`
8. поднимаем `tailscale u`
9. тебе консоль выдаст ссылку по которой надо перейти, зарегаться и так далее
10. как итог - перед тобой будет айпишник твоей малики, копируй его, по этому айпи ты будешь подключаться
11. бекаемся в режим чтения `ro`
12. готово

### Удаленное подключение

итак, у нас все готово, но как же подключаться вне сети?
базовая схема такая:
1. нужно устройство, которое также подключено в Tailscale, для этого нужно скачать прилу на машину (win, mac, ios, android, linux)
  - <img width="835" height="479" alt="image" src="https://github.com/user-attachments/assets/01012dcd-9335-4e75-90ac-d45bed82f1c3" />
2. далее можно спокойно пользоваться с браузера, подключаясь к впн через прилу (решение пиздатое, потому что внутрь сети есть возможность подключения прил и вроде как можно поднять что-угодно в докере)
3. для iOS (на Android хз, ебитес с этим сами) лично у меня есть решение - это JumpDesktop (за него надо плОтить шекели капиталистам, один раз, не подписка слава б-гу), тк я им пользовался ранее для управления компом, для подключения нужно ввести айпи из Tailscale, выбрать режим VNC, ввести логин пароль и готово... НО!!!!


### Безопасность

не думал что буду трястись над безопасностью, но тут дело такое:
1. я понял бы, если бы юзалась вся система исключительно локально, тогда простым логином паролем можно было бы обойтись, однако у нас штучка выходит в общую сеть и недоброжелатели могут получить доступ к вашему рабочему компу и создать очковое извержение у тебя, заруинив карьеру
2. поэтому рекомендую максимально делать 2Auth в самой Малинке, то есть даже если получат доступ, то тут барьер хорошенький
3. даже если этот барьер будет взломан, то рекомендую, если не активничаете, то блокировать экран рабочего компа, чтобы поставить еще один блок
4. что касается VNC со смартфонов, то соединения не защищены и не зашифрованы, их можно перехватить легко, поэтому (я пока этим занимаюсь, мб обновлю тутор) надо об этом позаботиться или хотяб держать в голове, и не забивать на пункт 2 и пункт 3

### Заключение
всем пасиба, если будут проблемы, то надеюсь, что разобраться своими силами и силами нейросетей сможешь
